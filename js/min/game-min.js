!function(){"use strict";window.Dino=function(a){var b,c,d=null,e="./img/dinosprite.png",f=2,g=[],h=0,i=0,j=0,k={start:null,current:null},l={verticalBoost:-13,animationStep:0,isJumping:!1,animationMaxSteep:0,isDangerZone:!1,collectedRubber:0,previousCollectedRubber:0,verticalSpeed:0,verticalAcceleration:0,oCurrentFrame:1,position:{top:0,bottom:0,left:0,right:0},init:function(){this.animationMaxSteep=this.spriteFrames.length,this.collectedRubber=0,this.previousCollectedRubber=0,v("#score",this.collectedRubber)},spriteFrames:[{sx:0,sy:30,sw:50,sh:60,dw:50},{sx:50,sy:30,sw:48,sh:60,dw:48},{sx:98,sy:30,sw:42,sh:60,dw:42},{sx:140,sy:30,sw:21,sh:60,dw:21},{sx:161,sy:30,sw:50,sh:60,dw:50}],frame:{dx:80,dy:212,dh:60},render:function(b){this.oCurrentFrame=this.spriteFrames[b],a.context.drawImage(d,this.oCurrentFrame.sx,this.oCurrentFrame.sy,this.oCurrentFrame.sw,this.oCurrentFrame.sh,this.frame.dx,this.frame.dy,this.oCurrentFrame.dw,this.frame.dh)},update:function(b){var c,d,e,f=g.length,h=this.position;for(b&&(this.verticalAcceleration||(this.verticalAcceleration=.8),!this.isJumping&&(this.verticalSpeed=this.verticalBoost),this.isJumping=!0),this.position.top=this.frame.dy-this.frame.dh,this.position.bottom=this.frame.dy+this.frame.dh,this.position.left=this.frame.dx-this.oCurrentFrame.dw,this.position.right=this.frame.dx+this.oCurrentFrame.dw,this.verticalSpeed+=this.verticalAcceleration,this.frame.dy+=this.verticalSpeed,this.frame.dy>212&&(this.frame.dy=212,this.verticalAcceleration=!1,this.isJumping=!1),c=0;f>c;c++)d=g[c].frame,e=a.height-(m.frame.dh+2*g[c].frame.dr),h.right>d.dx-d.dr&&h.left<d.dx-2*d.dr&&(h.bottom>e?t(this):this.isDangerZone=!0);this.isDangerZone?this.previousCollectedRubber===this.collectedRubber&&(this.collectedRubber++,v("#score",this.collectedRubber)):this.previousCollectedRubber=this.collectedRubber,this.isDangerZone=!1}},m={speed:5,frame:{sx:0,sy:0,sw:700,sh:30,dx:0,dy:270,dw:700,dh:30},maxOffset:700-a.width,render:function(){a.context.drawImage(d,this.frame.sx,this.frame.sy,this.frame.sw,this.frame.sh,this.frame.dx,this.frame.dy,this.frame.dw,this.frame.dh)},update:function(){this.frame.dx<=-this.maxOffset&&(this.frame.dx=0),this.frame.dx-=this.speed,this.render()}},n=function(a,b){this.frame={dx:a,dr:b}};n.prototype.speed=4,n.prototype.render=function(){var b=a.context;b.save(),b.beginPath(),b.fillStyle=a.color,b.arc(this.frame.dx,a.height-(this.frame.dr+m.frame.dh),this.frame.dr,90,0,2*Math.PI),b.fill()},n.prototype.update=function(){var b=Math.round(10*Math.random())+10,c=Math.round(250*Math.random())+200;this.frame.dx-=this.speed,this.frame.dx<=2*-this.frame.dr&&(this.frame.dx=a.width+c,this.frame.dr=b,this.speed+=.1),this.render()};var o=function(){g=[];for(var b,c,d=0,e=f;e>d;d++)b=Math.round(10*Math.random())+15,c=Math.round(500*Math.random())+200,g.push(new n(0===d?a.width+b:g[d-1].frame.dx+c,b))},p=function(){m.render(),window.addEventListener("keydown",r),window.addEventListener("keydown",q),l.render(1),u(211,30,203,86,(a.width-100)/2,(a.height-150)/3*2,203,86,"Appuyez sur la flèche du haut de votre clavier!",14)},q=function(a){38===a.keyCode&&l.update(a)},r=function(a){window.removeEventListener("keydown",r),38===a.keyCode&&(l.init(),o(),s(),w(a))},s=function(){var b,d=g.length;for(c=window.requestAnimationFrame(s),k.current=(new Date).getTime(),a.context.clearRect(0,0,a.width,a.height),m.update(),l.update(),b=0;d>b;b++)g[b].update();k.current-k.start>100&&(k.start=(new Date).getTime(),++l.animationStep<l.animationMaxSteep||(l.animationStep=0),w()),l.render(l.animationStep)},t=function(b){window.cancelAnimationFrame(c),h=0,i=0,j=0,u(414,36,138,80,(a.width-138)/2,(a.height-80)/2,138,68,"Votre score "+b.collectedRubber,20),window.addEventListener("keydown",r)},u=function(b,c,e,f,g,h,i,j,k,l){var m=a.context;m.fillStyle="black",m.font=" 100 "+l+"px Avenir, sans-serif",m.textAlign="center",m.texBasseline="top",m.fillText(k,300,a.height/3*2),m.drawImage(d,b,c,e,f,g,h,i,j)},v=function(a,b){var c=document.querySelector(a).childNodes[0];c.nodeValue=b},w=function(){h++,h>9&&(h=0,i++),i>59&&(i=0,j++),b=(10>j?"0"+j:j)+" : "+(10>i?"0"+i:i)+" : "+(10>h?"0"+h:h),v("#time",b)};d=new Image,d.addEventListener("load",p),d.src=e}}(),function(){"use strict";var a={canvas:null,width:null,height:null,context:null,color:null},b=function(a){return!!a.getContext};a.setup=function(){this.canvas=document.querySelector("#dino"),b(this.canvas)||console.error("Oups canvas n’est pas supporté."),this.width=this.canvas.width,this.height=this.canvas.height,this.context=this.canvas.getContext("2d"),this.color="#E56D25";new window.Dino(this)},a.setup()}();